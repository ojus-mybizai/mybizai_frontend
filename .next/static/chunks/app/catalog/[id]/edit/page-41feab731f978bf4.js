(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5188],{6405:function(e,t,a){Promise.resolve().then(a.bind(a,2330))},2330:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return c}});var i=a(7437),l=a(2265),r=a(4033),n=a(5628),d=a(3062),s=a(9843);function c(){let e=(0,r.useRouter)(),t=(0,r.useParams)(),{accessToken:a}=(0,d.tN)(),{updateItem:c,items:o}=(0,d.iC)(),[u,m]=(0,l.useState)(null),[p,y]=(0,l.useState)([]),[g,f]=(0,l.useState)(!0),[x,_]=(0,l.useState)(!1);(0,l.useEffect)(()=>{let i=async()=>{if(t.id&&a){f(!0);try{let[e,i]=await Promise.all([s.iJ.getCatalogItem(t.id,a),s.iJ.getCatalogTemplates(a)]),l={id:String(e.id),name:e.name,description:e.description||"",category:e.category||"",price:e.price,currency:e.currency,availability:e.availability,type:e.type,images:e.images,template_fields:e.extra_data,created_at:e.created_at,updated_at:e.updated_at};m(l);let r=i.map(e=>({id:String(e.id),name:e.name,description:"",fields:e.extra_metadata.map((e,t)=>({id:"field-".concat(t),label:e,type:"text",required:!1})),created_at:e.created_at,updated_at:e.updated_at}));y(r)}catch(t){console.error("Failed to fetch data:",t),t instanceof s.MS&&404===t.status?(alert("Item not found"),e.push("/catalog")):alert("Failed to load item data")}finally{f(!1)}}};i()},[a,t.id,e,o]);let h=async(i,l)=>{if(t.id&&a){_(!0);try{let r=[];if(l.length>0){let e=l.map(e=>s.iJ.uploadCatalogImage(e,a)),t=await Promise.all(e);r=t.map(e=>e.url)}let n=[...(null==u?void 0:u.images)||[],...r],d={name:i.name,description:i.description||null,category:i.category||null,price:i.price,currency:i.currency,availability:i.availability,type:i.type,images:n,extra_data:i.template_fields||{},template_id:null},o=await s.iJ.updateCatalogItem(t.id,d,a),m={id:String(o.id),name:o.name,description:o.description||"",category:o.category||"",price:o.price,currency:o.currency,availability:o.availability,type:o.type,images:o.images,template_fields:o.extra_data,created_at:o.created_at,updated_at:o.updated_at};c(t.id,m),e.push("/catalog")}catch(e){console.error("Failed to update item:",e),e instanceof s.MS?alert("Failed to update item: ".concat(e.message)):alert("Failed to update item. Please try again.")}finally{_(!1)}}};return a?g?(0,i.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,i.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):u?(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100",children:"Edit Item"}),(0,i.jsxs)("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:['Update details for "',u.name,'"']})]}),(0,i.jsx)(n.Z,{initialData:u,templates:p,onSubmit:h,onCancel:()=>{e.push("/catalog")},isLoading:x})]}):(0,i.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,i.jsx)("p",{className:"text-gray-500",children:"Item not found."})}):(0,i.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,i.jsx)("p",{className:"text-gray-500",children:"Please log in to edit catalog items."})})}new Date().toISOString(),new Date().toISOString()}},function(e){e.O(0,[9061,5166,9843,3062,6381,2971,2472,1744],function(){return e(e.s=6405)}),_N_E=e.O()}]);