(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4959],{1562:function(e,t,a){Promise.resolve().then(a.bind(a,3583))},3583:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return d}});var i=a(7437),r=a(2265),l=a(4033),c=a(5628),n=a(3062),s=a(9843);function d(){let e=(0,l.useRouter)(),{accessToken:t}=(0,n.tN)(),{addItem:a}=(0,n.iC)(),[d,o]=(0,r.useState)([]),[u,m]=(0,r.useState)(!1),[p,y]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let e=async()=>{if(t){m(!0);try{let e=await s.iJ.getCatalogTemplates(t),a=e.map(e=>({id:String(e.id),name:e.name,description:"",fields:e.extra_metadata.map((e,t)=>({id:"field-".concat(t),label:e,type:"text",required:!1})),created_at:e.created_at,updated_at:e.updated_at}));o(a)}catch(e){console.error("Failed to fetch templates:",e),o([])}finally{m(!1)}}};e()},[t]);let g=async(i,r)=>{if(t){y(!0);try{let l=[];if(r.length>0){let e=r.map(e=>s.iJ.uploadCatalogImage(e,t)),a=await Promise.all(e);l=a.map(e=>e.url)}let c={name:i.name,description:i.description||null,category:i.category||null,price:i.price,currency:i.currency,availability:i.availability,type:i.type,images:l,extra_data:i.template_fields||{},template_id:null},n=await s.iJ.createCatalogItem(c,t),d={id:String(n.id),name:n.name,description:n.description||"",category:n.category||"",price:n.price,currency:n.currency,availability:n.availability,type:n.type,images:n.images,template_fields:n.extra_data,created_at:n.created_at,updated_at:n.updated_at};a(d),e.push("/catalog")}catch(e){console.error("Failed to create item:",e),e instanceof s.MS?alert("Failed to create item: ".concat(e.message)):alert("Failed to create item. Please try again.")}finally{y(!1)}}};return t?u?(0,i.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,i.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100",children:"Add New Item"}),(0,i.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mt-1",children:"Create a new product or service for your catalog"})]}),(0,i.jsx)(c.Z,{templates:d,onSubmit:g,onCancel:()=>{e.push("/catalog")},isLoading:p})]}):(0,i.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,i.jsx)("p",{className:"text-gray-500",children:"Please log in to create catalog items."})})}new Date().toISOString(),new Date().toISOString()}},function(e){e.O(0,[9061,5166,9843,3062,6381,2971,2472,1744],function(){return e(e.s=1562)}),_N_E=e.O()}]);